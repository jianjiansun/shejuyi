<link rel="stylesheet" href="__PUBLIC__/Home/css/region.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/layui.css">
<link rel="stylesheet" href="__PUBLIC__/Home/css/page2.css">

<script src="__PUBLIC__/Home/street/jquery.citys.js"></script>
<script src="__PUBLIC__/Home/js/layui.js"></script>
<script src="__PUBLIC__/Home/js/layui.all.js"></script>
<script src="__PUBLIC__/Home/js/upLoadImgBig.js"></script>

<script src="__PUBLIC__/Home/js/plugins/cover_js/iscroll-zoom.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/plugins/cover_js/hammer.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/plugins/cover_js/lrz.all.bundle.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/plugins/cover_js/jquery.photoClip.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/Home/js/jQuery.upload.min.js"></script>
<link rel="stylesheet" href="__PUBLIC__/Home/css/upload.css">
<style>

</style>
</head>

<body>

    <div class="shadeBox" style="display: none;"></div>
    <div id="showCityBox" class="province-switch" style="display: none;">
    </div>

    <div class="headLogin">
        <div class="container">
            <div class="left changeBan logoPer">
                <a href="{$index}">
                    <img src="__PUBLIC__/Home/imgs/logo.png" alt="">
                    <span>社居易</span>
                </a>
            </div>
            <div class="right person">
                <!--<img src="__PUBLIC__/Home/imgs/personDl.jpg" alt="">-->
            </div>
        </div>
    </div>

    <div class="container main-container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="row clearfix">

                    <div class="col-md-2 column  perperson">
                        <h2>个人信息</h2>
                        <div>
                            <div class="user-img">
                                <img id="userImg" src="{$user_image}" alt="  ">
                                <span class="iconfont VIP-icon">&#xe65b;</span>
                            </div>
                            <p style="margin-top: 12px;">
                                VIP有效期 :<br>
                                <span class="blue-btn" style="background:#ffa34a;color: #ffffff;">2018-05-01~2019-05-01</span>
                            </p>
                            <!--用户图片更换-->
                            <div class="cropImgBox" ontouchstart="">
                                <div class="cover-wrap">
                                    <div class="coverBox">
                                        <div id="clipArea"></div>
                                        <div class="clipBtn">
                                            <button id="clipBtn">确定</button>
                                            <button onClick="javascript:$('.cover-wrap').fadeOut();">关闭</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="changePicBtn">
                                    点击更换图片
                                    <input type="file" id="file">
                                </div>
                            </div>
                        </div>

                        <ul class="person-ul">
                            <li>
                                <a href="__MODULE__/Origanization/origanizationIdentify">认证状态</a>
                            </li>
                            <if condition='($isidentify eq 1)'>
                            <li>
                                <a href="__MODULE__/Origanization/personInfo">账号设置</a>
                            </li>
                            </if>
                            <if condition='($isidentify eq 1) and ($code gt 0)'>
                                <li>
                                    <a href="__MODULE__/Origanization/myOriganization">我的机构</a>
                                </li>
                                <li>
                                    <a class="on" href="__MODULE__/Project/origanizationProjectManger">我的项目</a>
                                </li>
                                <li>
                                    <a href="__MODULE__/Home/displayOriganizationHome">机构主页</a>
                                </li>
                            </if>
                        </ul>
                    </div>
                    <div class="col-md-10 column perperson-con" style="background: #FFFFFF;">
                        <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                            <ul class="layui-tab-title">
                                <li class="layui-this" lay-id="a">基本信息</li>
                                <li lay-id="b">员工管理</li>
                                <li lay-id="c">机构风采</li>
                            </ul>
                            <div class="layui-tab-content">

                                <div class="layui-tab-item layui-show">
                                    <!--社会组织 —— 我的机构 —— 基本信息-->
                                    <form id="myForm" class="layui-form layui-form-pane basic-information" action="">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">机构名称</label>
                                            <div class="layui-input-block">
                                                <input name="origanization_name" disabled="disabled" required="" value="" placeholder="请输机构名字" autocomplete="off" class="layui-input" type="text">
                                                <a class="iconfont">&#xe600;</a>
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">机构地址</label>
                                            <div class="layui-input-block changeAddress">
                                                <div id="demo" style="margin-bottom: 10px;">
                                                    <p>
                                                        <select name="province"></select>
                                                        <select name="city"></select>
                                                        <select name="area"></select>
                                                    </p>
                                                </div>

                                                <div id="show"></div>
                                            </div>
                                        </div>

                                        <div class="layui-form-item">
                                            <label class="layui-form-label">详细地址</label>
                                            <div class="layui-input-block">
                                                <input name="address" disabled="disabled" value="" required="" placeholder="请输入机构地址" autocomplete="off" class="layui-input" type="text">
                                                <a class="iconfont">&#xe600;</a>
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">固定电话</label>
                                            <div class="layui-input-block">

                                                <input name="tel_code" value="" class="layui-input landlinePhoneNum" type="text" style="width: 42px;margin-right: 4px;">
                                                <input name="phone" value="" required="" placeholder="请输入固定电话号" autocomplete="off" class="layui-input landlinePhoneNum" type="text" style="width: 355px;">
                                                <a class="iconfont">&#xe600;</a>
                                                <div class="id-remider">
                                                    <p class="remider"></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-form-item layui-form-text">
                                            <label class="layui-form-label">机构简介</label>
                                            <div class="layui-input-block">
                                                <textarea id="textareaIntro" placeholder="请输入内容" class="layui-textarea"></textarea>
                                            </div>
                                        </div>
                                    </form>

                                    <div class="sure"><a class="layui-btn" href="javascript:;" id="sureBtn1">确定</a></div>

                                </div>

                                <div class="layui-tab-item">
                                    <!--社会组织 —— 我的机构 —— 员工管理-->
                                    <div class="basic-information">
                                        <a class="addMember" href="javascript:;">添加社工</a>
                                        <table class="layui-table">
                                            <colgroup>
                                                <!-- <col width="100">
                                            <col width="200">
                                            <col width="200"> -->
                                                <col width="200">
                                                <col width="200">
                                                <col width="200">
                                                <col width="200">
                                                <col width="200">

                                            </colgroup>
                                            <thead>
                                                <tr>
                                                    <th>姓名</th>
                                                    <th>手机号</th>
                                                    <th>邮箱</th>
                                                    <th>微信号</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tableBody">
                                                <!--  <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>
                                                <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                                                <a class="layui-btn layui-btn-xs">编辑</a>
                                                <a class="layui-btn layui-btn-danger layui-btn-xs" >删除</a>
                                            </td>

                                        </tr> -->
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="pagination" id="pagination1"></div>
                                </div>
                                <div class="layui-tab-item">
                                    <!--社会组织 —— 我的机构 —— 机构风采-->
                                    <div class="basic-information">
                                        <div class="img-box full">
                                            <section class=" img-section">
                                                <p class="up-p">机构logo：<span class="up-span">上传一张logo</span></p>
                                                <div class="case">
                                                    <div class="upload" data-type="png,jpg,jpeg,gif" action='__CONTROLLER__/uploadoriganizationlogo' data-file='logo' data-num='1' id='case3'></div>
                                                </div>
                                            </section>
                                            <section class=" img-section">
                                                <p class="up-p">机构风采：<span class="up-span">上传一张风采</span></p>
                                                <div class="case">
                                                    <div class="upload" style='width:500px;height:300px' data-type="png,jpg,jpeg,gif" action='__CONTROLLER__/uploadoriganizationimgs' data-num='1' id='case2'></div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row clearfix footerBox">
        <div class="container">
            <div class="copyright fl">
                <p class="left">北京社居易有限公司 版权所有</p>
                <p class="right">
                    Copyright © EasyLife.com All rights reserved.2017-2020 京ICP证1166666号 京公网安备133333333444
                </p>
            </div>
        </div>
    </div>
</body>
<script>
    $(function() {
        $("#case2").upload();
        $("#case3").upload();
    })
</script>
<script src="__PUBLIC__/Home/js/cityBoxShow.js"></script>
<script>
    $.post("__CONTROLLER__/getOriganizationInfo", function(data) {

        $("input[name=origanization_name]").val(data.sjy_origanization_name);
        $('input[name=address]').val(data.address_info.sjy_origanization_address);
        $('input[name=tel_code]').val(data.sjy_origanization_phone.split("-")[0]);
        $('input[name=phone]').val(data.sjy_origanization_phone.split("-")[1]);
        $('#textareaIntro').val(data.sjy_origanization_introduce);
        $('#demo').citys({
            code: data.address_info.sjy_origanization_area
        });
    });













































    /*个人图片的切换*/
    //上传封面
    //document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
    var clipArea = new bjj.PhotoClip("#clipArea", {
        size: [200, 200], // 截取框的宽和高组成的数组。默认值为[260,260]
        outputSize: [80, 80], // 输出图像的宽和高组成的数组。默认值为[0,0]，表示输出图像原始大小
        //outputType: "jpg", // 指定输出图片的类型，可选 "jpg" 和 "png" 两种种类型，默认为 "jpg"
        file: "#file", // 上传图片的<input type="file">控件的选择器或者DOM对象
        view: "#view", // 显示截取后图像的容器的选择器或者DOM对象
        ok: "#clipBtn", // 确认截图按钮的选择器或者DOM对象
        loadStart: function() {
            // 开始加载的回调函数。this指向 fileReader 对象，并将正在加载的 file 对象作为参数传入
            $('.cover-wrap').fadeIn();
            console.log("照片读取中");
        },
        loadComplete: function() {
            // 加载完成的回调函数。this指向图片对象，并将图片地址作为参数传入
            console.log("照片读取完成");
        },
        //loadError: function(event) {}, // 加载失败的回调函数。this指向 fileReader 对象，并将错误事件的 event 对象作为参数传入
        clipFinish: function(dataURL) {
            // 裁剪完成的回调函数。this指向图片对象，会将裁剪出的图像数据DataURL作为参数传入
            $('.cover-wrap').fadeOut();
            $('#view').css('background-size', '100% 100%');


            console.log(dataURL);

            $("#userImg").attr("src", dataURL);


            $.ajax({
                url: "__CONTROLLER__/douploadtouxiang",
                type: "POST",
                data: {
                    img: dataURL
                },
                dataType: "json",
                success: function(data) {
                    if (data.state == 1) {
                        layer.msg('修改成功');
                        console.log(data.url)
                    }
                },
                async: false
            });
            return false;



        }
    });
    //clipArea.destroy();





    // $('#demo').citys({code:350206});

    $(".basic-information .layui-input-block .iconfont").on("click", function() {
        $(this).prev("input").removeAttr("disabled").css("border", "1px solid #bbb");

        $(".basic-information .layui-input-block .layui-input").blur(function() {
            $(this).attr("disabled", "disabled").css("border", "1px solid #e6e6e6");
        });
    });
    /*手机号验证*/
    var landlinePhone = /^\d{7,8}$/;

    $(".landlinePhoneNum").blur(function() {

        if (!landlinePhone.test($(this).val())) {
            console.log("身份验证");
            $(this).siblings(".id-remider").children(".remider").html("请输入正确电话号码");
            console.log($(this).next().siblings(".remider"));
            $(this).removeAttr("disabled");
            return false
        } else {
            $(this).siblings(".id-remider").children(".remider").html("");
            $(this).attr("disabled", "disabled");
        }

    });


    $("#sureBtn1").click(function() {


        var origanization_name = $("input[name='origanization_name']").val();
        var province = $("select[name='province']")[0].value;
        var city = $("select[name='city']")[0].value;
        var area = $("select[name='area']")[0].value;
        var address = $("input[name='address']").val();
        var tel_code = $("input[name='tel_code']").val();
        var phone = $("input[name='phone']").val();
        var introduce = $("#textareaIntro").val();


        /* console.log(origanization_name);
         console.log(province);
         console.log(city);
         console.log(area);
         console.log(address);
         console.log(tel_code);
         console.log(phone);
         console.log(introduce);*/

        if (origanization_name == "") {
            layer.msg('请填写社会组织名');
            return false;
        }

        $.ajax({
            url: "__CONTROLLER__/updateOriganizationInfo",
            type: "POST",
            data: {
                origanization_name: origanization_name,
                province: province,
                city: city,
                area: area,
                address: address,
                tel_code: tel_code,
                phone: phone,
                introduce: introduce
            },
            dataType: "json",
            success: function(data) {

                if (data.state == 1) {
                    layer.msg('修改成功');
                }

            },
            async: false
        });
        return false;

    });
    
    //获得机构风采
    $.ajax({
        url: "__CONTROLLER__/getoriganizationimgs",
        type: "get",
        data: {},
        dataType: "json",
        success: function(data) {
            if (data) {
                $("#case2").attr('data-value', 'http://p33g9t7dr.bkt.clouddn.com/' + data);
            } else {
                // $("#imghead").attr('src', '__PUBLIC__/Home/imgs/a11.png')
            }
        }
    })
    //获得机构logo
    $.ajax({
        url: "__CONTROLLER__/getoriganizationlogo",
        type: "get",
        data: {},
        dataType: "json",
        success: function(data) {
            if (data) {
                $("#case3").attr('data-value', 'http://p33g9t7dr.bkt.clouddn.com/' + data);
            } else {
                // $("#imghead").attr('src', '__PUBLIC__/Home/imgs/a11.png')
            }
        }
    })
    $("#sureBtn3").click(function() {

        var file = $("#imghead").attr("src");
        console.log(file);

        $.ajax({
            url: "__CONTROLLER__/uploadoriganizationimgs",
            type: "POST",
            data: {
                file: file
            },
            dataType: "json",
            success: function(data) {

                // console.log(data);

                if (data.state == 1) {
                    layer.msg('上传成功');
                }

            },
            async: false
        });
        return false;

    });





    layui.use(['laypage', 'layer'], function() {
        var laypage = layui.laypage,
            layer = layui.layer;

        //执行一个laypage实例
        laypage.render({
            elem: 'pagination',
            count: 70 //数据总数，从服务端得到
                ,
            jump: function(obj, first) {
                //obj包含了当前分页的所有参数，比如：
                //console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                // console.log(obj.limit); //得到每页显示的条数
                //console.log("page");

                //首次不执行
                if (!first) {
                    //do something
                }
            }
        });
    });



    /*社会组织员工管理  */
    $.ajax({
        url: "__CONTROLLER__/getStaffList",
        type: "get",
        data: {
            page: 1
        },
        dataType: "json",
        success: function(data) {

            //console.log(data);
            var html = '';
            for (var i = 0; i < data.data.length; i++) {
                if(data.data[i].sjy_origanization_user_email!=null)
                {
                    var user_email = data.data[i].sjy_origanization_user_email;
                }else{
                    var user_email = '';
                }

                 if(data.data[i].sjy_origanization_user_wechat!=null)
                {
                    var user_wechat = data.data[i].sjy_origanization_user_wechat;
                }else{
                    var user_wechat = '';
                }
                html += '<tr>' +
                    '<td>' + data.data[i].sjy_origanization_user_real_name + '</td>' +
                    '<td class = "sjy_origanization_login_id">' + data.data[i].sjy_origanization_login_id + '</td>' +
                    '<td>' + user_email + '</td>' +
                    '<td>' + user_wechat + '</td>' +
                    '<td>' +
                    // '<a class="layui-btn layui-btn-primary layui-btn-xs">查看</a>' +
                    '<a class="layui-btn layui-btn-danger layui-btn-xs deleteEmployees" href = "javascript:;">删除</a>' +
                    '</td>' +
                    '</tr>';

                //  console.log(i);

            }

            $("#tableBody").html(html);

            $(".deleteEmployees").click(function() {

                //console.log( $(this).parents("tr") );

                var phone = $(this).parents("tr").children(".sjy_origanization_login_id").text();
                //  console.log(phone);

                $(this).parents("tr").remove();

                $.ajax({
                    url: "__CONTROLLER__/delStaff",
                    type: "POST",
                    data: {
                        phone: phone
                    },
                    dataType: "json",
                    success: function(data) {

                        //console.log(data);
                        if (data.state == 1) {
                            layer.msg('删除成功');
                        }

                    },
                    async: false
                });
                return false;

            });
        },
        async: false
    });
</script>

</html>